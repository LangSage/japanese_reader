<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Japanese Reading â€“ Big Story</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>
    :root {
      --bg: #050816;
      --card: #111827;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.08);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2937;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 60%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 720px;
    }

    .card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 18px;
      padding: 16px 16px 20px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(18px);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 12px;
    }

    .title {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      background: rgba(15, 23, 42, 0.9);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      white-space: nowrap;
    }

    .subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .hint {
      font-size: 0.8rem;
      padding: 10px 12px;
      border-radius: 12px;
      background: var(--accent-soft);
      border: 1px solid rgba(249, 115, 22, 0.25);
      color: #fed7aa;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 14px;
    }

    .hint span.icon {
      font-size: 1rem;
      margin-top: 1px;
    }

    .jp-block {
      background: radial-gradient(circle at top left, #111827 0, #020617 70%);
      border-radius: 14px;
      padding: 12px;
      border: 1px solid var(--border-subtle);
      margin-bottom: 10px;
    }

    .jp-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .jp-text {
      font-size: 1.05rem;
      line-height: 1.8;
    }

    .story-title {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .word {
      padding: 1px 3px;
      margin: 0 2px;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      transition: background 0.15s ease, box-shadow 0.15s ease,
        transform 0.08s ease;
      white-space: nowrap;
    }

    .word:hover {
      background: rgba(249, 115, 22, 0.12);
      box-shadow: 0 0 0 1px rgba(249, 115, 22, 0.35);
      transform: translateY(-1px);
    }

    .word:active {
      transform: translateY(0);
      background: rgba(249, 115, 22, 0.18);
    }

    .particle {
      opacity: 0.9;
    }

    /* Tooltip */
    #tooltip {
      position: absolute;
      z-index: 9999;
      pointer-events: none;
      background: #020617;
      border-radius: 10px;
      padding: 8px 10px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.8rem;
      line-height: 1.4;
      opacity: 0;
      transform: scale(0.92);
      transition: opacity 0.1s ease-out, transform 0.1s ease-out;
      min-width: 130px;
      max-width: 220px;
      color: var(--text-main);
    }

    #tooltip.visible {
      opacity: 1;
      transform: scale(1);
    }

    #tooltip .row-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 2px;
    }

    #tooltip .row-value {
      margin-bottom: 6px;
    }

    #tooltip .row-value:last-child {
      margin-bottom: 0;
    }

    #tooltip .romaji {
      color: #fee2e2;
      font-weight: 600;
    }

    #tooltip .translation {
      color: #bfdbfe;
    }

    footer {
      margin-top: 10px;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: center;
    }

    @media (min-width: 640px) {
      .card {
        padding: 18px 20px 22px;
      }
      .subtitle {
        font-size: 0.82rem;
      }
      .jp-text {
        font-size: 1.1rem;
      }
    }
  /* --- Mobile-first upgrades (bottom sheet popup) --- */
html { -webkit-text-size-adjust: 100%; }
* { -webkit-tap-highlight-color: transparent; }

.app { padding-bottom: 140px; } /* room for the bottom sheet */

.jp-text { font-size: clamp(1.05rem, 4.2vw, 1.16rem); line-height: 1.85; }

.word{
  padding: 4px 5px;
  margin: 0 1px;
  border-radius: 8px;
  white-space: normal; /* avoid overflow on narrow screens */
  user-select: none;
}

/* Only show hover effects on real hover devices (desktops) */
@media (hover: hover) and (pointer: fine) {
  .word:hover {
    background: rgba(249, 115, 22, 0.12);
    box-shadow: 0 0 0 1px rgba(249, 115, 22, 0.35);
    transform: translateY(-1px);
  }
}

.overlay{
  position: fixed;
  inset: 0;
  background: rgba(2, 6, 23, 0.55);
  backdrop-filter: blur(6px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 160ms ease;
  z-index: 9998;
}

.overlay.visible{ opacity: 1; pointer-events: auto; }

.sheet-wrap{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  justify-content: center;
  pointer-events: none;
  z-index: 9999;
}

.sheet{
  width: min(720px, 100%);
  pointer-events: auto;
  background: rgba(15, 23, 42, 0.98);
  border: 1px solid rgba(148, 163, 184, 0.35);
  border-radius: 18px 18px 0 0;
  box-shadow: 0 -18px 40px rgba(0,0,0,0.45);
  transform: translateY(110%);
  transition: transform 180ms ease;
  padding: 10px 14px calc(14px + env(safe-area-inset-bottom));
}

.sheet.open{ transform: translateY(0); }

.sheet .grab{
  width: 44px;
  height: 5px;
  border-radius: 999px;
  margin: 2px auto 10px;
  background: rgba(148, 163, 184, 0.35);
}

.sheet-head{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.sheet-word{
  font-weight: 800;
  letter-spacing: 0.02em;
  font-size: 1.05rem;
}

.sheet-close{
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: rgba(2, 6, 23, 0.45);
  color: var(--text-main);
  border-radius: 12px;
  padding: 8px 10px;
  font-size: 0.95rem;
  cursor: pointer;
}

.sheet-body{
  display: grid;
  gap: 10px;
}

.sheet-row .row-label{
  font-size: 0.72rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-bottom: 2px;
}

.sheet-row .row-value{
  font-size: 0.98rem;
  line-height: 1.35;
  word-break: break-word;
}

.sheet-actions{
  display: flex;
  gap: 10px;
  align-items: center;
  margin-top: 4px;
}

.btn{
  flex: 1;
  border: 1px solid rgba(249, 115, 22, 0.45);
  background: rgba(249, 115, 22, 0.14);
  color: #fed7aa;
  padding: 12px 12px;
  border-radius: 14px;
  font-weight: 700;
  cursor: pointer;
}

.btn:active{ transform: translateY(1px); }

.note{
  font-size: 0.8rem;
  color: var(--text-muted);
}

@media (prefers-reduced-motion: reduce) {
  * { transition: none !important; animation: none !important; }
}
</style>
</head>
<body>
<div class="app">
<div class="card">
<header>
<div>
<div class="title">
<span>ã«ã»ã‚“ã”ãƒªãƒ¼ãƒ€ãƒ¼</span>
</div>
<div class="subtitle">
            One big story. Tap a <strong>word</strong> to see
            <strong>romaji</strong>, <strong>translation</strong>, and hear audio.
          </div>
</div>
<div class="badge">Big Story</div>
</header>
<div class="hint">
<span class="icon">ğŸ’¡</span>
<div>
<div>Read slowly, line by line. Tap only the words you need.</div>
<div>Audio will play if this word has a generated sound file.</div>
</div>
</div>
<div class="story-title">ã‚ã‚“ãªã® ã„ã¡ã«ã¡ ğŸŒ…ğŸ«ğŸ </div>
<div class="jp-block">
<div class="jp-label">Japanese</div>
<div class="jp-text">
<span class="word" data-audio="audio/w001_ã‚ãŸã—.mp3" data-romaji="watashi" data-translation="I">ã‚ãŸã—</span>
<span class="word particle" data-audio="audio/w002_ã¯.mp3" data-romaji="wa" data-translation="topic marker">ã¯</span>
<span class="word" data-audio="audio/w003_ã‚ã‚“ãª.mp3" data-romaji="anna" data-translation="Anna">ã‚ã‚“ãª</span>
<span class="word" data-audio="audio/w004_ã§ã™.mp3" data-romaji="desu" data-translation="am / is / are">ã§ã™</span>ã€‚
          <span class="word" data-audio="audio/w005_ã«ã»ã‚“.mp3" data-romaji="nihon" data-translation="Japan">ã«ã»ã‚“</span>
<span class="word" data-audio="audio/w006_ã®.mp3" data-romaji="no" data-translation="of / 's">ã®</span>
<span class="word" data-audio="audio/w007_ã¡ã„ã•ãª.mp3" data-romaji="chiisana" data-translation="small">ã¡ã„ã•ãª</span>
<span class="word" data-audio="audio/w008_ã¾ã¡.mp3" data-romaji="machi" data-translation="town">ã¾ã¡</span>
<span class="word" data-audio="audio/w009_ã«.mp3" data-romaji="ni" data-translation="in / at / to">ã«</span>
<span class="word" data-audio="audio/w010_ã™ã‚“ã§ã„ã¾ã™.mp3" data-romaji="sundeimasu" data-translation="live">ã™ã‚“ã§ã„ã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w011_ã¾ã„ã‚ã•.mp3" data-romaji="maiasa" data-translation="every morning">ã¾ã„ã‚ã•</span>
<span class="word" data-audio="audio/w001_ã‚ãŸã—.mp3" data-romaji="watashi" data-translation="I">ã‚ãŸã—</span>
<span class="word particle" data-audio="audio/w002_ã¯.mp3" data-romaji="wa" data-translation="topic marker">ã¯</span>
<span class="word" data-audio="audio/w012_ã¯ã‚„ã.mp3" data-romaji="hayaku" data-translation="early / quickly">ã¯ã‚„ã</span>
<span class="word" data-audio="audio/w013_ãŠãã¦.mp3" data-romaji="okite" data-translation="wake up">ãŠãã¦</span>ã€
          <span class="word" data-audio="audio/w014_ã‚ã•ã”ã¯ã‚“.mp3" data-romaji="asagohan" data-translation="breakfast">ã‚ã•ã”ã¯ã‚“</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w016_ãŸã¹ã¾ã™.mp3" data-romaji="tabemasu" data-translation="eat">ãŸã¹ã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w017_ãŠã¡ã‚ƒ.mp3" data-romaji="ocha" data-translation="tea">ãŠã¡ã‚ƒ</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w018_ã®ã‚“ã§.mp3" data-romaji="nonde" data-translation="drink (and...)">ã®ã‚“ã§</span>ã€
          <span class="word" data-audio="audio/w019_ãŒã£ã“ã†.mp3" data-romaji="gakkou" data-translation="school">ãŒã£ã“ã†</span>
<span class="word" data-audio="audio/w020_ã¸.mp3" data-romaji="e" data-translation="to">ã¸</span>
<span class="word" data-audio="audio/w021_ã„ãã¾ã™.mp3" data-romaji="ikimasu" data-translation="go">ã„ãã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w019_ãŒã£ã“ã†.mp3" data-romaji="gakkou" data-translation="school">ãŒã£ã“ã†</span>
<span class="word" data-audio="audio/w022_ã§.mp3" data-romaji="de" data-translation="at / in">ã§</span>
<span class="word" data-audio="audio/w023_ã¨ã‚‚ã ã¡.mp3" data-romaji="tomodachi" data-translation="friend(s)">ã¨ã‚‚ã ã¡</span>
<span class="word" data-audio="audio/w024_ã¨.mp3" data-romaji="to" data-translation="with / and">ã¨</span>
<span class="word" data-audio="audio/w025_ã‚ã£ã¦.mp3" data-romaji="atte" data-translation="meet">ã‚ã£ã¦</span>ã€
          <span class="word" data-audio="audio/w026_ã«ã»ã‚“ã”.mp3" data-romaji="nihongo" data-translation="Japanese language">ã«ã»ã‚“ã”</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w027_ã¹ã‚“ãã‚‡ã†ã—ã¾ã™.mp3" data-romaji="benkyoushimasu" data-translation="study">ã¹ã‚“ãã‚‡ã†ã—ã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w028_ã²ã‚‹.mp3" data-romaji="hiru" data-translation="noon">ã²ã‚‹</span>
<span class="word" data-audio="audio/w029_ã‚„ã™ã¿.mp3" data-romaji="yasumi" data-translation="break / rest">ã‚„ã™ã¿</span>
<span class="word" data-audio="audio/w009_ã«.mp3" data-romaji="ni" data-translation="at / in">ã«</span>
<span class="word" data-audio="audio/w023_ã¨ã‚‚ã ã¡.mp3" data-romaji="tomodachi" data-translation="friend(s)">ã¨ã‚‚ã ã¡</span>
<span class="word" data-audio="audio/w024_ã¨.mp3" data-romaji="to" data-translation="with / and">ã¨</span>
<span class="word" data-audio="audio/w030_ã“ã†ãˆã‚“.mp3" data-romaji="kouen" data-translation="park">ã“ã†ãˆã‚“</span>
<span class="word" data-audio="audio/w020_ã¸.mp3" data-romaji="e" data-translation="to">ã¸</span>
<span class="word" data-audio="audio/w021_ã„ãã¾ã™.mp3" data-romaji="ikimasu" data-translation="go">ã„ãã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w031_ã¿ã©ã‚Š.mp3" data-romaji="midori" data-translation="green">ã¿ã©ã‚Š</span>
<span class="word" data-audio="audio/w006_ã®.mp3" data-romaji="no" data-translation="of / 's">ã®</span>
<span class="word" data-audio="audio/w032_ã.mp3" data-romaji="ki" data-translation="tree">ã</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w033_ã¿ã¦.mp3" data-romaji="mite" data-translation="look at / watch">ã¿ã¦</span>ã€
          <span class="word" data-audio="audio/w034_ã‹ã‚.mp3" data-romaji="kawa" data-translation="river">ã‹ã‚</span>
<span class="word" data-audio="audio/w006_ã®.mp3" data-romaji="no" data-translation="of / 's">ã®</span>
<span class="word" data-audio="audio/w035_ã¡ã‹ã.mp3" data-romaji="chikaku" data-translation="near / close">ã¡ã‹ã</span>
<span class="word" data-audio="audio/w022_ã§.mp3" data-romaji="de" data-translation="at / in">ã§</span>
<span class="word" data-audio="audio/w036_ãŠã¹ã‚“ã¨ã†.mp3" data-romaji="obentou" data-translation="bento lunch">ãŠã¹ã‚“ã¨ã†</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w016_ãŸã¹ã¾ã™.mp3" data-romaji="tabemasu" data-translation="eat">ãŸã¹ã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w037_ã„ã¬.mp3" data-romaji="inu" data-translation="dog">ã„ã¬</span>
<span class="word" data-audio="audio/w002_ã¯.mp3" data-romaji="wa" data-translation="topic marker">ã¯</span>
<span class="word" data-audio="audio/w038_ãã“.mp3" data-romaji="soko" data-translation="there">ãã“</span>
<span class="word" data-audio="audio/w022_ã§.mp3" data-romaji="de" data-translation="at / in">ã§</span>
<span class="word" data-audio="audio/w039_ã‚ãã³ã¾ã™.mp3" data-romaji="asobimasu" data-translation="play">ã‚ãã³ã¾ã™</span>ã€‚
          <span class="word" data-audio="audio/w040_ã“ã©ã‚‚ãŸã¡.mp3" data-romaji="kodomotachi" data-translation="children">ã“ã©ã‚‚ãŸã¡</span>
<span class="word" data-audio="audio/w002_ã¯.mp3" data-romaji="wa" data-translation="topic marker">ã¯</span>
<span class="word" data-audio="audio/w041_ãŸãã•ã‚“.mp3" data-romaji="takusan" data-translation="a lot / many">ãŸãã•ã‚“</span>
<span class="word" data-audio="audio/w042_ã‚ã‚‰ã„ã¾ã™.mp3" data-romaji="waraimasu" data-translation="laugh">ã‚ã‚‰ã„ã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w043_ã‚†ã†ãŒãŸ.mp3" data-romaji="yuugata" data-translation="evening">ã‚†ã†ãŒãŸ</span>ã€
          <span class="word" data-audio="audio/w001_ã‚ãŸã—.mp3" data-romaji="watashi" data-translation="I">ã‚ãŸã—</span>
<span class="word" data-audio="audio/w002_ã¯.mp3" data-romaji="wa" data-translation="topic marker">ã¯</span>
<span class="word" data-audio="audio/w044_ã†ã¡.mp3" data-romaji="uchi" data-translation="home / house">ã†ã¡</span>
<span class="word" data-audio="audio/w009_ã«.mp3" data-romaji="ni" data-translation="to / at">ã«</span>
<span class="word" data-audio="audio/w045_ã‹ãˆã‚Šã¾ã™.mp3" data-romaji="kaerimasu" data-translation="return / go back">ã‹ãˆã‚Šã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w046_ã‹ãã.mp3" data-romaji="kazoku" data-translation="family">ã‹ãã</span>
<span class="word" data-audio="audio/w024_ã¨.mp3" data-romaji="to" data-translation="with / and">ã¨</span>
<span class="word" data-audio="audio/w047_ã°ã‚“ã”ã¯ã‚“.mp3" data-romaji="bangohan" data-translation="dinner">ã°ã‚“ã”ã¯ã‚“</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w048_ãŸã¹ã¦.mp3" data-romaji="tabete" data-translation="eat (and...)">ãŸã¹ã¦</span>ã€
          <span class="word" data-audio="audio/w049_ãˆã„ãŒ.mp3" data-romaji="eiga" data-translation="movie">ãˆã„ãŒ</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w050_ã¿ã¾ã™.mp3" data-romaji="mimasu" data-translation="watch / see">ã¿ã¾ã™</span>ã€‚
          <br/>
<span class="word" data-audio="audio/w051_ã‚ˆã‚‹.mp3" data-romaji="yoru" data-translation="night">ã‚ˆã‚‹</span>ã€
          <span class="word" data-audio="audio/w001_ã‚ãŸã—.mp3" data-romaji="watashi" data-translation="I">ã‚ãŸã—</span>
<span class="word" data-audio="audio/w002_ã¯.mp3" data-romaji="wa" data-translation="topic marker">ã¯</span>
<span class="word" data-audio="audio/w052_ã»ã‚“.mp3" data-romaji="hon" data-translation="book">ã»ã‚“</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w053_ã‚ˆã¿ã¾ã™.mp3" data-romaji="yomimasu" data-translation="read">ã‚ˆã¿ã¾ã™</span>ã€‚
          <span class="word" data-audio="audio/w054_ã‚†ã£ãã‚Š.mp3" data-romaji="yukkuri" data-translation="slowly / relax">ã‚†ã£ãã‚Š</span>
<span class="word" data-audio="audio/w017_ãŠã¡ã‚ƒ.mp3" data-romaji="ocha" data-translation="tea">ãŠã¡ã‚ƒ</span>
<span class="word" data-audio="audio/w015_ã‚’.mp3" data-romaji="o" data-translation="object marker">ã‚’</span>
<span class="word" data-audio="audio/w018_ã®ã‚“ã§.mp3" data-romaji="nonde" data-translation="drink (and...)">ã®ã‚“ã§</span>ã€
          <span class="word" data-audio="audio/w055_ã­ã¾ã™.mp3" data-romaji="nemasu" data-translation="sleep / go to bed">ã­ã¾ã™</span>ã€‚
        </div>
</div>
<footer>
        Save as <code>jp-big-story.html</code> and open in your browser. Works offline
        (audio files must be in the <code>audio/</code> folder).
      </footer>
</div>
</div>
<div id="overlay" class="overlay" hidden></div>

<div class="sheet-wrap" aria-hidden="true">
  <div id="sheet" class="sheet" role="dialog" aria-modal="true" aria-label="Word info" hidden>
    <div class="grab" aria-hidden="true"></div>
    <div class="sheet-head">
      <div class="sheet-word" id="sheet-word">â€”</div>
      <button class="sheet-close" id="sheet-close" aria-label="Close">âœ•</button>
    </div>

    <div class="sheet-body">
      <div class="sheet-row">
        <div class="row-label">Romaji</div>
        <div class="row-value" id="sheet-romaji">â€”</div>
      </div>

      <div class="sheet-row">
        <div class="row-label">Translation</div>
        <div class="row-value" id="sheet-translation">â€”</div>
      </div>

      <div class="sheet-actions">
        <button class="btn" id="sheet-play" type="button">â–¶ Play audio</button>
      </div>
      <div class="note" id="sheet-note">Tap another word to update.</div>
    </div>
  </div>
</div>

<!-- Single audio player (we'll change src in JS) --> 
<audio id="word-audio"></audio>
<script>
(function () {
  const audioEl = document.getElementById("word-audio");
  const overlay = document.getElementById("overlay");
  const sheet = document.getElementById("sheet");
  const closeBtn = document.getElementById("sheet-close");
  const playBtn = document.getElementById("sheet-play");
  const wordEl = document.getElementById("sheet-word");
  const romajiEl = document.getElementById("sheet-romaji");
  const translationEl = document.getElementById("sheet-translation");
  const noteEl = document.getElementById("sheet-note");

  let activeWord = null;
  let prevOverflowBody = "";
  let prevOverflowHtml = "";

  function lockScroll(lock) {
    if (lock) {
      prevOverflowBody = document.body.style.overflow;
      prevOverflowHtml = document.documentElement.style.overflow;
      document.body.style.overflow = "hidden";
      document.documentElement.style.overflow = "hidden";
    } else {
      document.body.style.overflow = prevOverflowBody;
      document.documentElement.style.overflow = prevOverflowHtml;
    }
  }

  function openSheet(target) {
    activeWord = target;

    // highlight active word
    document.querySelectorAll(".word.active").forEach((n) => n.classList.remove("active"));
    target.classList.add("active");

    wordEl.textContent = target.textContent.trim() || "â€”";
    romajiEl.textContent = target.dataset.romaji || "â€”";
    translationEl.textContent = target.dataset.translation || "â€”";

    // show UI
    overlay.hidden = false;
    sheet.hidden = false;
    requestAnimationFrame(() => {
      overlay.classList.add("visible");
      sheet.classList.add("open");
    });

    lockScroll(true);

    // auto-play (if available)
    playAudio(target, true);
  }

  function closeSheet() {
    overlay.classList.remove("visible");
    sheet.classList.remove("open");
    lockScroll(false);

    setTimeout(() => {
      overlay.hidden = true;
      sheet.hidden = true;
      document.querySelectorAll(".word.active").forEach((n) => n.classList.remove("active"));
      activeWord = null;
    }, 180);
  }

  function playAudio(target, silentIfMissing) {
    const src = target?.dataset?.audio;
    if (!src) {
      noteEl.textContent = silentIfMissing ? "No audio for this word yet." : "No audio for this word yet.";
      return;
    }

    noteEl.textContent = "Playingâ€¦";

    if (audioEl.src.endsWith(src)) {
      audioEl.currentTime = 0;
    } else {
      audioEl.src = src;
      audioEl.load();
    }

    audioEl.play().then(() => {
      // ok
    }).catch(() => {
      noteEl.textContent = "Audio blocked by browser. Tap Play again.";
    });
  }

  function init() {
    document.querySelectorAll(".word").forEach((w) => {
      w.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        openSheet(w);
      }, { passive: false });
    });

    overlay.addEventListener("click", () => closeSheet());
    closeBtn.addEventListener("click", () => closeSheet());
    playBtn.addEventListener("click", () => activeWord && playAudio(activeWord, false));

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !sheet.hidden) closeSheet();
    });

    audioEl.addEventListener("ended", () => {
      if (!sheet.hidden) noteEl.textContent = "Done âœ…";
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>
</body>
</html>
